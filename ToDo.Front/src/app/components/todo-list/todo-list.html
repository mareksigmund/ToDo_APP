<mat-toolbar class="toolbar">
  <span class="logo">TASKBOARD</span>

  <span class="spacer"></span>

  <div class="toolbar-actions">
    <button mat-stroked-button class="toolbar-btn" type="button" (click)="loadTodos()">
      <mat-icon>refresh</mat-icon>
      Odśwież
    </button>

    <button
      mat-flat-button
      color="primary"
      class="toolbar-btn toolbar-btn-primary"
      type="button"
      (click)="isShowingCreateTodo = !isShowingCreateTodo"
    >
      <mat-icon>{{ isShowingCreateTodo ? 'remove' : 'add' }}</mat-icon>
      {{ isShowingCreateTodo ? 'Ukryj' : 'Dodaj' }}
    </button>
  </div>
</mat-toolbar>

<div class="page-wrapper">
  @if (isShowingCreateTodo) {
  <mat-card class="create-card">
    <div class="create-header">
      <button
        mat-icon-button
        type="button"
        (click)="isShowingCreateTodo = false"
        aria-label="Zamknij"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <app-todo-create (created)="onTodoCreated($event)"></app-todo-create>
  </mat-card>
  }

  <div class="header-row">
    <mat-card class="page-title-card">
      <div class="page-title-content">
        <div class="page-title-left">
          <mat-icon class="page-title-icon">checklist</mat-icon>

          <div class="page-title-texts">
            <h1>ToDo List</h1>
            <p>Twoje zadania w jednym, uporządkowanym miejscu</p>
          </div>
        </div>

        <div class="page-title-right">
          <span class="tasks-count">
            {{ todos.length }} {{ todos.length === 1 ? 'zadanie' : 'zadań' }}
          </span>
        </div>
      </div>
    </mat-card>
  </div>

  @if (isLoading) {
  <div class="center">
    <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
  </div>
  } @if (error) {
  <mat-card class="error-card">
    {{ error }}
  </mat-card>
  } @if (!isLoading && !error && todos.length > 0) {
  <div
    class="todo-list"
    cdkDropList
    [cdkDropListData]="todos"
    (cdkDropListDropped)="onDrop($event)"
  >
    @for (todo of todos; track todo.id) {
    <mat-card class="todo-card" cdkDrag [cdkDragData]="todo">
      <div class="todo-main">
        <div class="todo-left">
          <div class="drag-handle" cdkDragHandle>
            <mat-icon>drag_indicator</mat-icon>
          </div>

          <mat-checkbox
            class="todo-checkbox"
            [checked]="todo.isCompleted"
            (change)="onToggleStatus(todo)"
          >
          </mat-checkbox>

          <div class="todo-texts">
            <div class="todo-title" [class.completed]="todo.isCompleted">
              {{ todo.title }}
            </div>

            @if (todo.description) {
            <div class="todo-desc" [attr.title]="todo.description || null">
              {{ todo.description }}
            </div>
            }
          </div>
        </div>

        <div class="todo-right">
          <span class="todo-status-pill" [class.completed]="todo.isCompleted">
            {{ todo.isCompleted ? 'Zrobione' : 'Do zrobienia' }}
          </span>

          <div class="todo-actions">
            <button
              mat-icon-button
              type="button"
              aria-label="Szczegóły"
              (click)="goToDetails(todo.id)"
            >
              <mat-icon>info</mat-icon>
            </button>

            <button mat-icon-button [routerLink]="['/todos', todo.id, 'edit']" aria-label="Edytuj">
              <mat-icon>edit</mat-icon>
            </button>

            <button
              mat-icon-button
              color="warn"
              type="button"
              (click)="onDelete(todo.id)"
              aria-label="Usuń"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </mat-card>
    }
  </div>
  } @if (!isLoading && !error && todos.length === 0) {
  <div class="empty">Brak zadań. Użyj przycisku „Dodaj”, aby utworzyć pierwsze.</div>
  }
</div>
